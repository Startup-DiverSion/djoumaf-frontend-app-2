var C=Object.defineProperty;var I=(i,r,a)=>r in i?C(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a;var h=(i,r,a)=>I(i,typeof r!="symbol"?r+"":r,a);import{a_ as j,H as S,U as g,G as w,N as E,A as P,v as U,P as q,Q as R,a$ as A}from"./index-D5ohQRTx.js";class p{constructor(){h(this,"__AuthValidate",new j)}async __AuthRessoucre(r,a){try{const{error:l,context:c}=await this.__AuthValidate.register(a);if(l)return{data:null,error:c};const{data:u}=await S.post(r,a);if(u)return{data:u,error:null}}catch(l){if(l.response)return{data:null,error:[l.response.data]}}}async register(r){return await this.__AuthRessoucre(g.AUTH_REGISTER,r)}async login(r){return await this.__AuthRessoucre(g.AUTH_LOGIN,r)}async verifyEmail(r){return await this.__AuthRessoucre(g.AUTH_VERIFY_EMAIL,r)}async changePassword(r){return await this.__AuthRessoucre(g.AUTH_CHANGE_PASSWORD,r)}}const G=()=>{const i=w({loading:!1}),r=E(),a=P(),l=U({}),c=w({email:"",password:"",signin_place:{},device:{}}),u=w({email:""}),y=w({email:"",code:"",old_password:"",new_password:""}),e=new q,o=new R,m=async()=>{try{const{data:t}=await S.get("https://ipapi.co/json/");t.ip&&(c.signin_place=t,c.device=await A.getInfo())}catch{c.signin_place={},c.device=await A.getInfo()}},d=async(t,n)=>{const s=await t;if(s!=null&&s.error)return i.loading=!1,l.value=s==null?void 0:s.error[0];n(s)};return{state:i,router:r,route:a,isError:l,inputData:c,inputDataPassword:y,inputDataOnlyEmail:u,SignUp:async t=>(i.loading=!0,await m(),await d(new p().register(c),async n=>{var s,f;n!=null&&n.data&&(e.set("jToken",o.qCrypt(n==null?void 0:n.data.user.token)),e.set("jProfileID",o.qCrypt(`${(f=(s=n==null?void 0:n.data)==null?void 0:s.profile)==null?void 0:f.id}`)),e.set("jUserID",o.qCrypt(`${n==null?void 0:n.data.user.id}`)),i.loading=!1),r.replace({name:"AuthProfileIndex"})})),SignIn:async()=>(i.loading=!0,await d(new p().login(c),async t=>{t!=null&&t.data&&(e.set("jToken",o.qCrypt(t==null?void 0:t.data.user.token)),e.set("jUserID",o.qCrypt(`${t==null?void 0:t.data.user.id}`)),e.set("jProfileID",o.qCrypt(`${t==null?void 0:t.data.user.profile.id}`)),e.set("jProfileSetp",o.qCrypt(`${t==null?void 0:t.data.user.profile.lvl}`)),e.set("jUser",o.qCrypt(JSON.stringify(t==null?void 0:t.data.user))),i.loading=!1),a.query.redirect?window.location.assign(`${a.query.redirect}`):window.location.assign("/feeds")})),SignVerifyEmail:async()=>(i.loading=!0,await d(new p().verifyEmail(u),()=>{e.set("jEmail",o.qCrypt(u.email)),r.push({name:"SignChangePassword"}),i.loading=!1})),SignChangePassword:async t=>{try{return i.loading=!0,await e.get("jEmail").then(n=>{n&&(y.email=o.qDecrypted(n),i.loading=!1)}),await d(new p().changePassword(y),()=>{e.clear(),e.set("jPasswordChange",!0),window.location.assign("/feeds")})}catch{i.loading=!1}}}};export{G as u};
